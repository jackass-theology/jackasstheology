var tdLiveCssMain;
(function(b,d){tdLiveCssMain={_isInitialized:!1,_mouseInitialPosition:d,_editorMoving:!1,_editorResizing:!1,$_editorWrapper:d,$_window:d,_resizeOffset:d,init:function(){tdLiveCssMain._isInitialized||(tdLiveCssMain.$_window=b(window),tdLiveCssMain.$_editorWrapper=b("#tdw-css-writer"),tdLiveCssMain._isInitialized=!0)},getEditorPosition:function(){return tdLiveCssMain._editorPosition},setEditorPosition:function(b){tdLiveCssMain._editorPosition=tdLiveCssMain.$_editorWrapper.offset()},setMouseInitialPosition:function(b){tdLiveCssMain._mouseInitialPosition=
b},getMouseInitialPosition:function(){return tdLiveCssMain._mouseInitialPosition}};b().ready(function(){function g(a,b){return _.isEmpty(window.tdwGlobal.permalinkStructure)?window.tdwGlobal.wpRestUrl+a+"&"+b:window.tdwGlobal.wpRestUrl+a+"?"+b}function h(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}tdLiveCssMain.init();var f=!1;b("#wp-admin-bar-td_live_css_css_writer a").click(function(a){a.preventDefault();
a.stopPropagation();b("#tdw-css-writer").toggleClass("tdw-visible")});b("#tdw-css-writer").click(function(a){f=!0});b("body").click(function(a){!0===f?f=!1:(a=b("#tdw-css-writer"),a.hasClass("tdw-visible")&&a.removeClass("tdw-visible"))});b(".tdw-tab").click(function(a){a.preventDefault();b(this).hasClass("tdc-tab-active")||(b(".tdc-tab-active").removeClass("tdc-tab-active"),b(this).addClass("tdc-tab-active"),b(".tdw-tabs-content").hide(),b("."+b(this).data("tab-content")).show())});b(".tdw-save-css").click(function(a){a.preventDefault();
if(!b(this).hasClass("tdw-saving-animation")){b(this).addClass("tdw-saving-animation");var c={},e={};b(".tdw-css-writer-editor").each(function(a){e=b(this).val();less.render(b(this).val(),function(a,b){"undefined"!==typeof b&&(c=b.css)})});""===c&&(e=c="empty");b.ajax({timeout:1E4,type:"POST",url:g("tdw/save_css","uuid="+h()),beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",window.tdwGlobal.wpRestNonce)},dataType:"json",data:{compiled_css:c,less_input:e}}).done(function(a,c,e){window.onbeforeunload=
"";b(".tdw-saving-animation").removeClass("tdw-saving-animation")}).fail(function(a,b,c){})}});b("body").on("mousedown","#tdw-css-writer .tdw-resize",function(a){if(a.currentTarget===a.target){var c=b(a.currentTarget);tdLiveCssMain._editorResizing=!0;tdLiveCssMain.setEditorPosition(a);tdLiveCssMain.setMouseInitialPosition({left:a.pageX,top:a.pageY});tdLiveCssMain._resizeOffset={width:c.width(),height:c.height(),offsetLeft:a.pageX-c.offset().left,offsetTop:a.pageY-c.offset().top}}}).on("mouseup","#tdw-css-writer .tdw-resize",
function(a){a.currentTarget===a.target&&(tdLiveCssMain._editorMoving=!1,tdLiveCssMain.setMouseInitialPosition(d),tdLiveCssMain._diffGap=d)}).on("mousedown","#tdw-css-writer > header",function(a){b(this);a.currentTarget===a.target&&(tdLiveCssMain._editorMoving=!0,tdLiveCssMain.setEditorPosition(a),tdLiveCssMain.setMouseInitialPosition({left:a.pageX,top:a.pageY}))}).on("mouseup","#tdw-css-writer > header",function(a){b(this);a.currentTarget===a.target&&(tdLiveCssMain._editorMoving=!1,tdLiveCssMain.setEditorPosition(a),
tdLiveCssMain.setMouseInitialPosition(d))}).on("mouseup",function(a){tdLiveCssMain._editorMoving=!1;tdLiveCssMain._editorResizing=!1;tdLiveCssMain.setEditorPosition(a);tdLiveCssMain._resizeOffset=d;tdLiveCssMain.setMouseInitialPosition({left:a.pageX,top:a.pageY})}).on("mousemove",function(a){b(this);if(tdLiveCssMain._editorMoving){a.stopPropagation();a.preventDefault();var c=tdLiveCssMain.getMouseInitialPosition();if("undefined"!==typeof c){var e=tdLiveCssMain.getEditorPosition();tdLiveCssMain.$_editorWrapper.css({left:a.pageX-
tdLiveCssMain.$_window.scrollLeft()-(c.left-e.left),top:a.pageY-tdLiveCssMain.$_window.scrollTop()-(c.top-e.top)})}}else if(tdLiveCssMain._editorResizing&&(a.stopPropagation(),a.preventDefault(),c=tdLiveCssMain.getMouseInitialPosition(),"undefined"!==typeof c)){var d={offsetLeft:0,offsetTop:0};_.isUndefined(tdLiveCssMain._resizeOffset)||(d=tdLiveCssMain._resizeOffset);e=tdLiveCssMain.getEditorPosition();c=a.pageX-e.left+d.width-d.offsetLeft;a=a.pageY-e.top+d.height-d.offsetTop;tdLiveCssMain.$_editorWrapper.css({width:c,
height:a});tdLiveCssMain.$_editorWrapper.data("width",c);tdLiveCssMain.$_editorWrapper.data("height",a);tdLiveCssMain._timerResize=setTimeout(function(){"undefined"!==typeof tdLiveCssMain._timerResize&&(clearTimeout(tdLiveCssMain._timerResize),editor.resize(!0))},100)}})})})(jQuery);
